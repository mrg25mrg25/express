jwt authentication
// JWT à¦Ÿà§‹à¦•à§‡à¦¨ à¦¬à¦¾à¦¨à¦¾à¦¨à§‹à¦° à¦²à¦¾à¦‡à¦¬à§à¦°à§‡à¦°à¦¿ à¦‡à¦¨à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦²à¦¾à¦®
const jwt = require('jsonwebtoken');

// Express à¦à¦° à¦œà¦¨à§à¦¯ JWT à¦¯à¦¾à¦šà¦¾à¦‡ à¦•à¦°à¦¾à¦° middleware à¦‡à¦¨à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦²à¦¾à¦®
const expressJwt = require('express-jwt');

// à¦Ÿà§‹à¦•à§‡à¦¨ à¦¬à¦¾à¦¨à¦¾à¦¤à§‡ à¦à¦¬à¦‚ à¦¯à¦¾à¦šà¦¾à¦‡ à¦•à¦°à¦¤à§‡ à¦à¦‡ à¦¸à¦¿à¦•à§à¦°à§‡à¦Ÿ à¦šà¦¾à¦¬à¦¿ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¬
const SECRET = 'your-jwt-secret';

// à¦‡à¦‰à¦œà¦¾à¦° à¦²à¦—à¦‡à¦¨ à¦•à¦°à¦¾à¦° à¦¸à¦®à§Ÿ à¦Ÿà§‹à¦•à§‡à¦¨ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¾ à¦¹à¦¬à§‡
app.post('/login', (req, res) => {
  // à¦à¦–à¦¾à¦¨à§‡ à¦§à¦°à§‡ à¦¨à¦¿à¦šà§à¦›à¦¿ à¦‡à¦‰à¦œà¦¾à¦° à¦ à¦¿à¦• à¦†à¦›à§‡ (à¦¬à¦¾à¦¸à§à¦¤à¦¬à§‡ à¦¡à¦¾à¦Ÿà¦¾à¦¬à§‡à¦œ à¦¥à§‡à¦•à§‡ à¦šà§‡à¦• à¦•à¦°à¦¤à§‡ à¦¹à§Ÿ)
  const user = { id: 1, username: 'admin' };

  // à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦¤à¦¥à§à¦¯ à¦¦à¦¿à§Ÿà§‡ JWT à¦Ÿà§‹à¦•à§‡à¦¨ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦²à¦¾à¦®, à¦¯à§‡à¦Ÿà¦¾ à§§ à¦˜à¦£à§à¦Ÿà¦¾ à¦šà¦²à¦¬à§‡
  const token = jwt.sign(user, SECRET, { expiresIn: '1h' });

  // à¦Ÿà§‹à¦•à§‡à¦¨ à¦‡à¦‰à¦œà¦¾à¦°à¦•à§‡ à¦°à§‡à¦¸à¦ªà¦¨à§à¦¸ à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦ªà¦¾à¦ à¦¿à§Ÿà§‡ à¦¦à¦¿à¦²à¦¾à¦®
  res.json({ token });
});

// à¦à¦‡ à¦°à¦¾à¦‰à¦Ÿà¦Ÿà¦¾ à¦¸à¦¿à¦•à¦¿à¦‰à¦°, à¦à¦–à¦¾à¦¨à§‡ à¦Ÿà§‹à¦•à§‡à¦¨ à¦›à¦¾à§œà¦¾ à¦•à§‡à¦‰ à¦¢à§à¦•à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡ à¦¨à¦¾
app.get('/protected', expressJwt({ secret: SECRET }), (req, res) => {
  // à¦Ÿà§‹à¦•à§‡à¦¨ à¦¸à¦ à¦¿à¦• à¦¹à¦²à§‡ à¦à¦‡ à¦¡à¦¾à¦Ÿà¦¾ à¦¦à§‡à¦–à¦¾à¦¨à§‹ à¦¹à¦¬à§‡
  res.send('Protected data');
});

// à¦¯à¦¦à¦¿ à¦Ÿà§‹à¦•à§‡à¦¨ à¦­à§à¦² à¦¹à§Ÿ à¦¬à¦¾ à¦¨à¦¾ à¦¥à¦¾à¦•à§‡, à¦¤à¦¾à¦¹à¦²à§‡ à¦à¦–à¦¾à¦¨à§‡ à¦à¦°à¦° à¦§à¦°à¦¬à§‹
app.use((err, req, res, next) => {
  // à¦¯à¦¦à¦¿ à¦à¦°à¦° à¦¹à§Ÿ à¦Ÿà§‹à¦•à§‡à¦¨ à¦¸à¦‚à¦•à§à¦°à¦¾à¦¨à§à¦¤, à¦¤à¦¾à¦¹à¦²à§‡ 401 à¦¦à¦¿à§Ÿà§‡ à¦œà¦¾à¦¨à¦¿à§Ÿà§‡ à¦¦à¦¿à¦¬
  if(err.name === 'UnauthorizedError') {
    res.status(401).send('Invalid token');
  }
});
//â€¦..............â€¦â€¦





// express-rate-limit

// JWT à¦Ÿà§‹à¦•à§‡à¦¨ à¦¬à¦¾à¦¨à¦¾à¦¨à§‹à¦° à¦²à¦¾à¦‡à¦¬à§à¦°à§‡à¦°à¦¿ à¦‡à¦¨à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦²à¦¾à¦®
const jwt = require('jsonwebtoken');

// Express à¦à¦° à¦œà¦¨à§à¦¯ JWT à¦¯à¦¾à¦šà¦¾à¦‡ à¦•à¦°à¦¾à¦° middleware à¦‡à¦¨à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦²à¦¾à¦®
const expressJwt = require('express-jwt');

// Rate limit middleware à¦‡à¦¨à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦²à¦¾à¦®
const rateLimit = require('express-rate-limit');

// à¦Ÿà§‹à¦•à§‡à¦¨ à¦¬à¦¾à¦¨à¦¾à¦¤à§‡ à¦à¦¬à¦‚ à¦¯à¦¾à¦šà¦¾à¦‡ à¦•à¦°à¦¤à§‡ à¦à¦‡ à¦¸à¦¿à¦•à§à¦°à§‡à¦Ÿ à¦šà¦¾à¦¬à¦¿ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¬
const SECRET = 'your-jwt-secret';

// Rate limiter à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦²à¦¾à¦®: à§§ à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡ à¦à¦•à¦œà¦¨ à¦‡à¦‰à¦œà¦¾à¦° à§«à¦¬à¦¾à¦° à¦°à¦¿à¦•à§à§Ÿà§‡à¦¸à§à¦Ÿ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡
const limiter = rateLimit({
  windowMs: 1 * 60 * 1000, // à§§ à¦®à¦¿à¦¨à¦¿à¦Ÿ
  max: 5, // à¦¸à¦°à§à¦¬à§‹à¦šà§à¦š à§« à¦¬à¦¾à¦°
  message: 'Too many requests, please try again later.' // à¦²à¦¿à¦®à¦¿à¦Ÿ à¦ªà§‡à¦°à¦¾à¦²à§‡ à¦à¦‡ à¦®à§‡à¦¸à§‡à¦œ à¦¦à¦¿à¦¬à§‡
});

// à¦²à¦—à¦‡à¦¨ à¦°à¦¾à¦‰à¦Ÿà§‡ à¦°à§‡à¦Ÿ à¦²à¦¿à¦®à¦¿à¦Ÿ à¦…à§à¦¯à¦¾à¦ªà§à¦²à¦¾à¦‡ à¦•à¦°à¦²à¦¾à¦®
app.post('/login', limiter, (req, res) => {
  // à¦à¦–à¦¾à¦¨à§‡ à¦§à¦°à§‡ à¦¨à¦¿à¦šà§à¦›à¦¿ à¦‡à¦‰à¦œà¦¾à¦° à¦ à¦¿à¦• à¦†à¦›à§‡ (à¦¬à¦¾à¦¸à§à¦¤à¦¬à§‡ à¦¡à¦¾à¦Ÿà¦¾à¦¬à§‡à¦œ à¦¥à§‡à¦•à§‡ à¦šà§‡à¦• à¦•à¦°à¦¤à§‡ à¦¹à§Ÿ)
  const user = { id: 1, username: 'admin' };

  // à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦¤à¦¥à§à¦¯ à¦¦à¦¿à§Ÿà§‡ JWT à¦Ÿà§‹à¦•à§‡à¦¨ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦²à¦¾à¦®, à¦¯à§‡à¦Ÿà¦¾ à§§ à¦˜à¦£à§à¦Ÿà¦¾ à¦šà¦²à¦¬à§‡
  const token = jwt.sign(user, SECRET, { expiresIn: '1h' });

  // à¦Ÿà§‹à¦•à§‡à¦¨ à¦‡à¦‰à¦œà¦¾à¦°à¦•à§‡ à¦°à§‡à¦¸à¦ªà¦¨à§à¦¸ à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦ªà¦¾à¦ à¦¿à§Ÿà§‡ à¦¦à¦¿à¦²à¦¾à¦®
  res.json({ token });
});

// à¦à¦‡ à¦°à¦¾à¦‰à¦Ÿà¦Ÿà¦¾ à¦¸à¦¿à¦•à¦¿à¦‰à¦°, à¦à¦–à¦¾à¦¨à§‡ à¦Ÿà§‹à¦•à§‡à¦¨ à¦›à¦¾à§œà¦¾ à¦•à§‡à¦‰ à¦¢à§à¦•à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡ à¦¨à¦¾
app.get('/protected', expressJwt({ secret: SECRET, algorithms: ['HS256'] }), (req, res) => {
  // à¦Ÿà§‹à¦•à§‡à¦¨ à¦¸à¦ à¦¿à¦• à¦¹à¦²à§‡ à¦à¦‡ à¦¡à¦¾à¦Ÿà¦¾ à¦¦à§‡à¦–à¦¾à¦¨à§‹ à¦¹à¦¬à§‡
  res.send('Protected data');
});

// à¦¯à¦¦à¦¿ à¦Ÿà§‹à¦•à§‡à¦¨ à¦­à§à¦² à¦¹à§Ÿ à¦¬à¦¾ à¦¨à¦¾ à¦¥à¦¾à¦•à§‡, à¦¤à¦¾à¦¹à¦²à§‡ à¦à¦–à¦¾à¦¨à§‡ à¦à¦°à¦° à¦§à¦°à¦¬à§‹
app.use((err, req, res, next) => {
  // à¦¯à¦¦à¦¿ à¦à¦°à¦° à¦¹à§Ÿ à¦Ÿà§‹à¦•à§‡à¦¨ à¦¸à¦‚à¦•à§à¦°à¦¾à¦¨à§à¦¤, à¦¤à¦¾à¦¹à¦²à§‡ 401 à¦¦à¦¿à§Ÿà§‡ à¦œà¦¾à¦¨à¦¿à§Ÿà§‡ à¦¦à¦¿à¦¬
  if(err.name === 'UnauthorizedError') {
    res.status(401).send('Invalid token');
  }
});
//...................






// Mongoose à¦²à¦¾à¦‡à¦¬à§à¦°à§‡à¦°à¦¿ à¦‡à¦¨à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦²à¦¾à¦® (MongoDB à¦à¦° à¦¸à¦¾à¦¥à§‡ à¦•à¦¾à¦œ à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯)
const mongoose = require('mongoose');

// MongoDB à¦¡à¦¾à¦Ÿà¦¾à¦¬à§‡à¦¸à§‡à¦° à¦¸à¦¾à¦¥à§‡ à¦•à¦¾à¦¨à§‡à¦•à¦¶à¦¨ à¦•à¦°à¦²à¦¾à¦®
mongoose.connect('mongodb://localhost:27017/mydb', {
  useNewUrlParser: true,        // à¦¨à¦¤à§à¦¨ URL à¦ªà¦¾à¦°à§à¦¸à¦¾à¦° à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¬à§‹
  useUnifiedTopology: true      // à¦‡à¦‰à¦¨à¦¿à¦«à¦¾à¦‡à¦¡ à¦Ÿà¦ªà§‹à¦²à¦œà¦¿ à¦šà¦¾à¦²à§ à¦•à¦°à¦¬à§‹ (à¦¨à¦¤à§à¦¨ à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦®)
})
.then(() => console.log('MongoDB connected'))  // à¦•à¦¾à¦¨à§‡à¦•à¦¶à¦¨ à¦¸à¦«à¦² à¦¹à¦²à§‡ à¦®à§‡à¦¸à§‡à¦œ à¦¦à¦¿à¦¬à§‡
.catch(err => console.error('Connection error:', err)); // à¦•à¦¾à¦¨à§‡à¦•à¦¶à¦¨à§‡ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à¦²à§‡ à¦à¦°à¦° à¦¦à§‡à¦–à¦¾à¦¬à§‡

// à¦à¦•à¦Ÿà¦¿ à¦‡à¦‰à¦œà¦¾à¦° à¦®à¦¡à§‡à¦² à¦¬à¦¾à¦¨à¦¾à¦²à¦¾à¦® (Schema à¦›à¦¾à§œà¦¾à¦“ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡ à¦¸à¦°à¦²à¦¤à¦¾à¦° à¦œà¦¨à§à¦¯)
const User = mongoose.model('User', {
  name: String,   // à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦¨à¦¾à¦® à¦¸à§à¦Ÿà§‹à¦° à¦¹à¦¬à§‡
  email: String   // à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦‡à¦®à§‡à¦‡à¦² à¦¸à§à¦Ÿà§‹à¦° à¦¹à¦¬à§‡
});

// POST à¦°à¦¾à¦‰à¦Ÿ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦²à¦¾à¦®: à¦¨à¦¤à§à¦¨ à¦‡à¦‰à¦œà¦¾à¦° à¦¬à¦¾à¦¨à¦¾à¦¨à§‹à¦° à¦œà¦¨à§à¦¯
app.post('/users', async (req, res) => {
  try {
    // à¦‡à¦‰à¦œà¦¾à¦° à¦…à¦¬à¦œà§‡à¦•à§à¦Ÿ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦²à¦¾à¦® à¦°à¦¿à¦•à§à§Ÿà§‡à¦¸à§à¦Ÿ à¦¥à§‡à¦•à§‡ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¡à§‡à¦Ÿà¦¾ à¦¦à¦¿à§Ÿà§‡
    const user = new User(req.body);

    // à¦¡à¦¾à¦Ÿà¦¾à¦¬à§‡à¦¸à§‡ à¦¸à§‡à¦‡à¦­ à¦•à¦°à¦²à¦¾à¦®
    await user.save();

    // à§¨à§¦à§§ à¦®à¦¾à¦¨à§‡: Created. à¦¸à§‡à¦‡à¦­ à¦¸à¦«à¦² à¦¹à¦²à§‡ à¦‡à¦‰à¦œà¦¾à¦°à¦•à§‡ à¦°à§‡à¦¸à¦ªà¦¨à§à¦¸ à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦ªà¦¾à¦ à¦¾à¦²à¦¾à¦®
    res.status(201).send(user);
  } catch (err) {
    // à¦•à§‹à¦¨à§‹ à¦à¦°à¦° à¦¹à¦²à§‡ à§ªà§¦à§¦ (Bad Request) à¦¦à¦¿à§Ÿà§‡ à¦à¦°à¦° à¦ªà¦¾à¦ à¦¾à¦²à¦¾à¦®
    res.status(400).send(err);
  }
});
///////////////////////////////





 

// supertest à¦²à¦¾à¦‡à¦¬à§à¦°à§‡à¦°à¦¿ à¦¦à¦¿à§Ÿà§‡ HTTP à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦œà¦¨à§à¦¯ request à¦«à¦¾à¦‚à¦¶à¦¨ à¦†à¦¨à¦¾ à¦¹à§Ÿà§‡à¦›à§‡
const request = require('supertest');
// à¦…à§à¦¯à¦¾à¦ªà§‡à¦° à¦®à§‡à¦‡à¦¨ à¦«à¦¾à¦‡à¦² (à¦¯à§‡à¦–à¦¾à¦¨à§‡ express app à¦¬à¦¾à¦¨à¦¾à¦¨à§‹ à¦¹à§Ÿ) à¦‡à¦®à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡
const app = require('../app');

// describe à¦¬à§à¦²à¦•à§‡à¦° à¦­à¦¿à¦¤à¦°à§‡ 'GET /api/users' à¦°à§à¦Ÿ à¦à¦° à¦Ÿà§‡à¦¸à§à¦Ÿ à¦¶à§à¦°à§
describe('GET /api/users', () => {

  // à¦à¦‡ à¦Ÿà§‡à¦¸à§à¦Ÿà¦Ÿà¦¾ à¦šà§‡à¦• à¦•à¦°à§‡ à¦¸à¦¬ à¦‡à¦‰à¦œà¦¾à¦° à¦«à¦¿à¦°à¦¾à§Ÿ à¦•à¦¿à¦¨à¦¾
  it('should return all users', async () => {
    const res = await request(app)         // app à¦à¦° à¦‰à¦ªà¦° à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¨à§‹
      .get('/api/users')                   // GET à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ
      .expect(200);                        // HTTP status 200 à¦†à¦¶à¦¾ à¦•à¦°à¦¾ à¦¹à§Ÿ

    expect(Array.isArray(res.body)).toBeTruthy(); // à¦°à§‡à¦¸à¦ªà¦¨à§à¦¸ à¦¬à¦¡à¦¿ à¦à¦•à¦Ÿà¦¾ array à¦•à¦¿à¦¨à¦¾ à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à§Ÿ
  });

  // à¦à¦‡ à¦Ÿà§‡à¦¸à§à¦Ÿà¦Ÿà¦¾ à¦šà§‡à¦• à¦•à¦°à§‡ à¦¨à¦¤à§à¦¨ à¦‡à¦‰à¦œà¦¾à¦° à¦¤à§ˆà¦°à¦¿ à¦¹à§Ÿ à¦•à¦¿à¦¨à¦¾
  it('should create a new user', async () => {
    const res = await request(app)             // app à¦à¦° à¦‰à¦ªà¦° à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¨à§‹
      .post('/api/users')                      // POST à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ
      .send({ name: 'John', email: 'john@example.com' }) // à¦‡à¦‰à¦œà¦¾à¦° à¦¡à§‡à¦Ÿà¦¾ à¦ªà¦¾à¦ à¦¾à¦¨à§‹
      .expect(201);                            // HTTP status 201 à¦†à¦¶à¦¾ à¦•à¦°à¦¾ à¦¹à§Ÿ (Created)

    expect(res.body.name).toBe('John');        // à¦°à§‡à¦¸à¦ªà¦¨à§à¦¸ à¦¬à¦¡à¦¿à¦¤à§‡ name à¦ à¦¿à¦• à¦†à¦›à§‡ à¦•à¦¿à¦¨à¦¾ à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à§Ÿ
  });

});
////////////////////






// Express à¦«à§à¦°à§‡à¦®à¦“à§Ÿà¦¾à¦°à§à¦• à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡ à¦§à¦°à§‡ à¦¨à¦¿à¦šà§à¦›à¦¿
const express = require('express');   // Express à¦‡à¦®à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦¾
const app = express();                // à¦…à§à¦¯à¦¾à¦ª à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¾

// Health check endpoint à¦¤à§ˆà¦°à¦¿
app.get('/health', (req, res) => {        // à¦¯à¦–à¦¨ à¦•à§‡à¦‰ '/health' à¦°à¦¾à¦‰à¦Ÿà§‡ GET à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¬à§‡
  res.status(200).send('Server is healthy'); // à¦¤à¦–à¦¨ à§¨à§¦à§¦ status à¦¦à¦¿à§Ÿà§‡ "Server is healthy" à¦ªà¦¾à¦ à¦¾à¦¬à§‡
});

// à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦šà¦¾à¦²à§ à¦•à¦°à¦¾
app.listen(3000, () => {
  console.log('Server is running on port 3000');
});
/////////////////ðŸ«£ðŸ«£ðŸ«£ðŸ«£








// express-validator à¦²à¦¾à¦‡à¦¬à§à¦°à§‡à¦°à¦¿ à¦¥à§‡à¦•à§‡ body à¦“ validationResult à¦‡à¦®à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡
const { body, validationResult } = require('express-validator');

// POST /users à¦°à¦¾à¦‰à¦Ÿ à¦¡à¦¿à¦«à¦¾à¦‡à¦¨ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡
app.post('/users', 
  [
    // email à¦«à¦¿à¦²à§à¦¡à¦Ÿà¦¾ à¦­à§à¦¯à¦¾à¦²à¦¿à¦¡ à¦‡à¦®à§‡à¦‡à¦² à¦•à¦¿à¦¨à¦¾ à¦šà§‡à¦• à¦•à¦°à§‡, à¦¤à¦¾à¦°à¦ªà¦° normalize à¦•à¦°à§‡ (lowercase + trim)
    body('email').isEmail().normalizeEmail(),
    
    // password à¦«à¦¿à¦²à§à¦¡ à¦•à¦®à¦ªà¦•à§à¦·à§‡ à§¬ à¦…à¦•à§à¦·à¦°à§‡à¦° à¦•à¦¿à¦¨à¦¾ à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à§Ÿ
    body('password').isLength({ min: 6 })
  ],
  (req, res) => {
    // validation result à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡
    const errors = validationResult(req);
    
    // à¦¯à¦¦à¦¿ à¦•à§‹à¦¨à§‹ à¦à¦°à¦° à¦¥à¦¾à¦•à§‡, à¦¤à¦¾à¦¹à¦²à§‡ 400 status à¦¦à¦¿à§Ÿà§‡ error à¦—à§à¦²à¦¾ à¦°à¦¿à¦Ÿà¦¾à¦°à§à¦¨ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡
    if (!errors.isEmpty()) {
      return res.status(400).json({ errors: errors.array() });
    }
    
    // à¦¯à¦¦à¦¿ à¦¡à¦¾à¦Ÿà¦¾ à¦­à§à¦¯à¦¾à¦²à¦¿à¦¡ à¦¹à§Ÿ, à¦¤à¦¾à¦¹à¦²à§‡ à¦à¦‡ à¦œà¦¾à§Ÿà¦—à¦¾à§Ÿ à¦‡à¦‰à¦œà¦¾à¦° à¦ªà§à¦°à¦¸à§‡à¦¸ (create) à¦•à¦°à¦¾ à¦¹à¦¬à§‡
    res.send('User created successfully');
  }
);
///////???/////////




// file download 

// fs à¦“ path à¦®à¦¡à¦¿à¦‰à¦² à¦‡à¦®à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡ à¦«à¦¾à¦‡à¦² à¦®à§à¦¯à¦¾à¦¨à§‡à¦œà¦®à§‡à¦¨à§à¦Ÿà§‡à¦° à¦œà¦¨à§à¦¯
const fs = require('fs');
const path = require('path');

// Express à¦à¦° GET route à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡ '/download' à¦
app.get('/download', (req, res) => {

  // à¦¸à¦¾à¦°à§à¦­à¦¾à¦°à§‡à¦° à¦­à¦¿à¦¤à¦°à§‡ à¦•à§‹à¦¨ à¦«à¦¾à¦‡à¦² à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡ à¦•à¦°à¦¾à¦¤à§‡ à¦šà¦¾à¦‡ à¦¤à¦¾ path à¦¦à¦¿à§Ÿà§‡ à¦¸à§‡à¦Ÿ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡
  const filePath = path.join(__dirname, 'files/report.pdf');

  // à¦ªà§à¦°à¦¥à¦®à§‡ à¦šà§‡à¦• à¦•à¦°à¦›à¦¿ à¦«à¦¾à¦‡à¦²à¦Ÿà¦¾ à¦¸à¦¤à§à¦¯à¦¿ à¦†à¦›à§‡ à¦•à¦¿à¦¨à¦¾
  if (fs.existsSync(filePath)) {

    // à¦«à¦¾à¦‡à¦²à¦Ÿà¦¾ à¦†à¦›à§‡, à¦¤à¦¾à¦‡ à¦¸à§‡à¦Ÿà¦¾à¦•à§‡ à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡ à¦•à¦°à¦¾à¦¨à§‹ à¦¹à¦šà§à¦›à§‡
    // à¦¦à§à¦¬à¦¿à¦¤à§€à§Ÿ à¦ªà§à¦¯à¦¾à¦°à¦¾à¦®à¦¿à¦Ÿà¦¾à¦° à¦¦à¦¿à§Ÿà§‡ à¦«à¦¾à¦‡à¦²à§‡à¦° à¦¨à¦¾à¦® à¦•à¦¾à¦¸à§à¦Ÿà¦®à¦¾à¦‡à¦œ à¦•à¦°à¦¾ à¦¯à¦¾à¦šà§à¦›à§‡
    res.download(filePath, 'custom-filename.pdf', (err) => {

      // à¦¯à¦¦à¦¿ à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡à§‡ à¦•à§‹à¦¨à§‹ error à¦†à¦¸à§‡, à¦¸à§‡à¦Ÿà¦¾ à¦§à¦°à§‡ à¦¨à¦¿à¦šà§à¦›à§‡ à¦à¦–à¦¾à¦¨à§‡
      if (err) {
        console.error('Download error:', err);
        res.status(500).send('Download failed');  // error message à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à¦šà§à¦›à§‡
      }
    });

  } else {
    // à¦¯à¦¦à¦¿ à¦«à¦¾à¦‡à¦² à¦¨à¦¾ à¦¥à¦¾à¦•à§‡, à¦¤à¦–à¦¨ 404 status à¦¦à¦¿à§Ÿà§‡ "file not found" à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à¦šà§à¦›à§‡
    res.status(404).send('File not found');
  }
});
/////////////////






// Express à¦“ WebSocket à¦®à¦¡à¦¿à¦‰à¦² à¦‡à¦®à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡
const express = require('express');
const WebSocket = require('ws');

// Express à¦…à§à¦¯à¦¾à¦ªà§à¦²à¦¿à¦•à§‡à¦¶à¦¨ à¦¤à§ˆà¦°à¦¿
const app = express();
// Express à¦¸à¦¾à¦°à§à¦­à¦¾à¦° 3000 à¦ªà§‹à¦°à§à¦Ÿà§‡ à¦šà¦²à¦›à§‡
const server = app.listen(3000);

// WebSocket à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦¤à§ˆà¦°à¦¿, express à¦¸à¦¾à¦°à§à¦­à¦¾à¦°à§‡à¦° à¦¸à¦¾à¦¥à§‡ à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡
const wss = new WebSocket.Server({ server });

// WebSocket à¦•à¦¾à¦¨à§‡à¦•à¦¶à¦¨ à¦¹à§à¦¯à¦¾à¦¨à§à¦¡à§‡à¦² à¦•à¦°à¦¾
wss.on('connection', (ws) => {
  console.log('New client connected');  // à¦¨à¦¤à§à¦¨ à¦•à§à¦²à¦¾à§Ÿà§‡à¦¨à§à¦Ÿ à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿ à¦¹à¦²à§‡ à¦®à§‡à¦¸à§‡à¦œ à¦¦à§‡à¦–à¦¾à¦¬à§‡
  
  // à¦•à§à¦²à¦¾à§Ÿà§‡à¦¨à§à¦Ÿ à¦¥à§‡à¦•à§‡ à¦®à§‡à¦¸à§‡à¦œ à¦†à¦¸à¦²à§‡ à¦¸à§‡à¦Ÿà¦¿ à¦¹à§à¦¯à¦¾à¦¨à§à¦¡à§‡à¦² à¦•à¦°à¦¾
  ws.on('message', (message) => {
    console.log(`Received: ${message}`);  // à¦•à§à¦²à¦¾à§Ÿà§‡à¦¨à§à¦Ÿà§‡à¦° à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦®à§‡à¦¸à§‡à¦œ à¦•à¦¨à¦¸à§‹à¦²à§‡ à¦¦à§‡à¦–à¦¾à¦¬à§‡
    
    // à¦¸à¦®à¦¸à§à¦¤ à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿà§‡à¦¡ à¦•à§à¦²à¦¾à§Ÿà§‡à¦¨à§à¦Ÿà§‡ à¦®à§‡à¦¸à§‡à¦œ à¦¬à§à¦°à¦¡à¦•à¦¾à¦¸à§à¦Ÿ à¦•à¦°à¦¾
    wss.clients.forEach(client => {
      if(client.readyState === WebSocket.OPEN) {  // à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡ à¦•à§à¦²à¦¾à§Ÿà§‡à¦¨à§à¦Ÿ à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿà§‡à¦¡ à¦•à¦¿ à¦¨à¦¾
        client.send(`Server: ${message}`);  // à¦¸à¦¾à¦°à§à¦­à¦¾à¦°à§‡à¦° à¦¸à¦¾à¦‡à¦¡ à¦¥à§‡à¦•à§‡ à¦®à§‡à¦¸à§‡à¦œ à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à¦šà§à¦›à§‡
      }
    });
  });

  // à¦•à§à¦²à¦¾à§Ÿà§‡à¦¨à§à¦Ÿ à¦¡à¦¿à¦¸à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿ à¦¹à¦²à§‡ à¦•à¦¨à¦¸à§‹à¦²à§‡ à¦®à§‡à¦¸à§‡à¦œ à¦¦à§‡à¦–à¦¾à¦¬à§‡
  ws.on('close', () => {
    console.log('Client disconnected');
  });
});
///////////////////////////



